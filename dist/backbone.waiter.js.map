{"version":3,"file":"backbone.waiter.js","sources":["../src/helpers.js","../src/baseView.js","../src/autoLoader.js","../src/main.js"],"sourcesContent":["import $ from \"jquery\";\r\nimport Backbone from \"backbone\";\r\nimport _ from \"underscore\";\r\n\r\nlet Waiter = {};\r\n\r\n// Helpers\r\n// -------\r\n\r\n// Waiter.extend\r\n// -----------------\r\n\r\n// Borrow the Backbone `extend` method so we can use it as needed\r\nWaiter.extend = Backbone.Model.extend;\r\n\r\n// Waiter.isNodeAttached\r\n// -------------------------\r\n\r\n// Determine if `el` is a child of the document\r\nWaiter.isNodeAttached = el => Backbone.$.contains(document.documentElement, el);\r\n\r\n// Merge `keys` from `options` onto `this`\r\nWaiter.mergeOptions = function(options, keys) {\r\n  if (!options) {\r\n    return;\r\n  }\r\n  _.extend(this, _.pick(options, keys));\r\n};\r\n\r\n// Waiter.getOption\r\n// --------------------\r\n\r\n// Retrieve an object, function or other value from a target\r\n// object or its `options`, with `options` taking precedence.\r\nWaiter.getOption = (target, optionName) => {\r\n  if (!target || !optionName) {\r\n    return;\r\n  }\r\n  if (target.options && target.options[optionName] !== undefined) {\r\n    return target.options[optionName];\r\n  } else {\r\n    return target[optionName];\r\n  }\r\n};\r\n\r\n// Proxy `Waiter.getOption`\r\nWaiter.proxyGetOption = function(optionName) {\r\n  return Waiter.getOption(this, optionName);\r\n};\r\n\r\n// Similar to `_.result`, this is a simple helper\r\n// If a function is provided we call it with context\r\n// otherwise just return the value. If the value is\r\n// undefined return a default value\r\nWaiter._getValue = (value, context, params) => {\r\n  if (_.isFunction(value)) {\r\n    value = params ? value.apply(context, params) : value.call(context);\r\n  }\r\n  return value;\r\n};\r\n\r\n// Waiter.normalizeMethods\r\n// ----------------------\r\n\r\n// Pass in a mapping of events => functions or function names\r\n// and return a mapping of events => functions\r\nWaiter.normalizeMethods = function(hash) {\r\n  return _.reduce(\r\n    hash,\r\n    function(normalizedHash, method, name) {\r\n      if (!_.isFunction(method)) {\r\n        method = this[method];\r\n      }\r\n      if (method) {\r\n        normalizedHash[name] = method;\r\n      }\r\n      return normalizedHash;\r\n    },\r\n    {},\r\n    this\r\n  );\r\n};\r\n\r\n// utility method for parsing @ui. syntax strings\r\n// into associated selector\r\nWaiter.normalizeUIString = (uiString, ui) =>\r\n  uiString.replace(/@ui\\.[a-zA-Z_$0-9]*/g, r => ui[r.slice(4)]);\r\n\r\n// allows for the use of the @ui. syntax within\r\n// a given key for triggers and events\r\n// swaps the @ui with the associated selector.\r\n// Returns a new, non-mutated, parsed events hash.\r\nWaiter.normalizeUIKeys = (hash, ui) =>\r\n  _.reduce(\r\n    hash,\r\n    (memo, val, key) => {\r\n      var normalizedKey = Waiter.normalizeUIString(key, ui);\r\n      memo[normalizedKey] = val;\r\n      return memo;\r\n    },\r\n    {}\r\n  );\r\n\r\n// allows for the use of the @ui. syntax within\r\n// a given value for regions\r\n// swaps the @ui with the associated selector\r\nWaiter.normalizeUIValues = (hash, ui, properties) => {\r\n  _.each(hash, (val, key) => {\r\n    if (_.isString(val)) {\r\n      hash[key] = Waiter.normalizeUIString(val, ui);\r\n    } else if (_.isObject(val) && _.isArray(properties)) {\r\n      _.extend(val, Waiter.normalizeUIValues(_.pick(val, properties), ui));\r\n      /* Value is an object, and we got an array of embedded property names to normalize. */\r\n      _.each(properties, property => {\r\n        var propertyVal = val[property];\r\n        if (_.isString(propertyVal)) {\r\n          val[property] = Waiter.normalizeUIString(propertyVal, ui);\r\n        }\r\n      });\r\n    }\r\n  });\r\n  return hash;\r\n};\r\n\r\nexport default Waiter;\r\n","import $ from \"jquery\";\r\nimport Backbone from \"backbone\";\r\nimport _ from \"underscore\";\r\nimport Waiter from \"./helpers\";\r\n\r\n// Waiter.BaseView\r\n//-------------------\r\n\r\nexport default Backbone.View.extend({\r\n  isDestroyed: false,\r\n\r\n  constructor(options) {\r\n    this.render = _.bind(this.render, this);\r\n\r\n    options = Waiter._getValue(options, this);\r\n\r\n    // this exposes view options to the view initializer\r\n    // this is a backfill since backbone removed the assignment\r\n    // of this.options\r\n    // at some point however this may be removed\r\n    this.options = _.extend({}, _.result(this, \"options\"), options);\r\n\r\n    Backbone.View.call(this, this.options);\r\n  },\r\n\r\n  // normalize the keys of passed hash with the views `ui` selectors.\r\n  // `{\"@ui.foo\": \"bar\"}`\r\n  normalizeUIKeys(hash) {\r\n    var uiBindings = _.result(this, \"_uiBindings\");\r\n    return Waiter.normalizeUIKeys(hash, uiBindings || _.result(this, \"ui\"));\r\n  },\r\n\r\n  // normalize the values of passed hash with the views `ui` selectors.\r\n  // `{foo: \"@ui.bar\"}`\r\n  normalizeUIValues(hash, properties) {\r\n    var ui = _.result(this, \"ui\");\r\n    var uiBindings = _.result(this, \"_uiBindings\");\r\n    return Waiter.normalizeUIValues(hash, uiBindings || ui, properties);\r\n  },\r\n\r\n  bindUIElements() {\r\n    this._bindUIElements();\r\n  },\r\n\r\n  // This method binds the elements specified in the \"ui\" hash inside the view's code with\r\n  // the associated jQuery selectors.\r\n  _bindUIElements() {\r\n    if (!this.ui) {\r\n      return;\r\n    }\r\n\r\n    // store the ui hash in _uiBindings so they can be reset later\r\n    // and so re-rendering the view will be able to find the bindings\r\n    if (!this._uiBindings) {\r\n      this._uiBindings = this.ui;\r\n    }\r\n\r\n    // get the bindings result, as a function or otherwise\r\n    var bindings = _.result(this, \"_uiBindings\");\r\n\r\n    // empty the ui so we don't have anything to start with\r\n    this.ui = {};\r\n\r\n    // bind each of the selectors\r\n    _.each(\r\n      bindings,\r\n      function(selector, key) {\r\n        this.ui[key] = this.$(selector);\r\n      },\r\n      this\r\n    );\r\n  },\r\n\r\n  // This method unbinds the elements specified in the \"ui\" hash\r\n  unbindUIElements() {\r\n    this._unbindUIElements();\r\n  },\r\n\r\n  _unbindUIElements() {\r\n    if (!this.ui || !this._uiBindings) {\r\n      return;\r\n    }\r\n\r\n    // delete all of the existing ui bindings\r\n    _.each(\r\n      this.ui,\r\n      function($el, name) {\r\n        delete this.ui[name];\r\n      },\r\n      this\r\n    );\r\n\r\n    // reset the ui element to the original bindings configuration\r\n    this.ui = this._uiBindings;\r\n    delete this._uiBindings;\r\n  },\r\n\r\n  // Overriding Backbone.View's delegateEvents to handle ui events\r\n  delegateEvents(events) {\r\n    this._delegateDOMEvents(events);\r\n\r\n    return this;\r\n  },\r\n\r\n  // internal method to delegate DOM events and triggers\r\n  _delegateDOMEvents(eventsArg) {\r\n    var events = Waiter._getValue(eventsArg || this.events, this);\r\n\r\n    // normalize ui keys\r\n    events = this.normalizeUIKeys(events);\r\n    if (_.isUndefined(eventsArg)) {\r\n      this.events = events;\r\n    }\r\n\r\n    var combinedEvents = {};\r\n    _.extend(combinedEvents, events);\r\n\r\n    Backbone.View.prototype.delegateEvents.call(this, combinedEvents);\r\n  },\r\n\r\n  destroy() {\r\n    if (this.isDestroyed) {\r\n      return this;\r\n    }\r\n\r\n    var args = _.toArray(arguments);\r\n    this.isDestroyed = true;\r\n\r\n    // unbind UI elements\r\n    this.unbindUIElements();\r\n\r\n    this.isRendered = false;\r\n\r\n    // remove the view from the DOM\r\n    this.remove();\r\n\r\n    return this;\r\n  },\r\n\r\n  // overridable render after everything is ready.\r\n  onRender() {},\r\n\r\n  render() {\r\n    this.isRendered = true;\r\n    this.bindUIElements();\r\n    this.onRender();\r\n\r\n    return this;\r\n  }\r\n});\r\n","import $ from 'jquery'\r\n\r\nexport default function (View, props) {\r\n    if (View) {\r\n      var myView = new View(props)\r\n      if ($(myView.el).length > 0) {\r\n        // hook up ui and events\r\n        myView.render()\r\n      }\r\n    }\r\n  }","import baseView from './baseView';\r\nimport autoLoader from './autoLoader';\r\n\r\nlet Waiter = {};\r\n\r\nWaiter.BaseView = baseView;\r\nWaiter.AutoLoader = autoLoader;\r\n\r\nexport default Waiter;\r\n\r\n"],"names":["Waiter","extend","Backbone","Model","isNodeAttached","$","contains","document","documentElement","el","mergeOptions","options","keys","_","pick","getOption","target","optionName","undefined","proxyGetOption","_getValue","value","context","params","isFunction","apply","call","normalizeMethods","hash","reduce","normalizedHash","method","name","normalizeUIString","uiString","ui","replace","r","slice","normalizeUIKeys","memo","val","key","normalizedKey","normalizeUIValues","properties","each","isString","isObject","isArray","propertyVal","property","View","render","bind","result","uiBindings","_bindUIElements","_uiBindings","bindings","selector","_unbindUIElements","$el","events","_delegateDOMEvents","eventsArg","isUndefined","combinedEvents","prototype","delegateEvents","isDestroyed","args","toArray","arguments","unbindUIElements","isRendered","remove","bindUIElements","onRender","props","myView","length","BaseView","baseView","AutoLoader","autoLoader"],"mappings":"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"}