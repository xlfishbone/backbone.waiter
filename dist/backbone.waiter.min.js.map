{"version":3,"file":"backbone.waiter.min.js","sources":["../src/helpers.js","../src/baseView.js","../src/main.js","../src/autoLoader.js"],"sourcesContent":["import $ from \"jquery\";\r\nimport Backbone from \"backbone\";\r\nimport _ from \"underscore\";\r\n\r\nlet Waiter = {};\r\n\r\n// Helpers\r\n// -------\r\n\r\n// Waiter.extend\r\n// -----------------\r\n\r\n// Borrow the Backbone `extend` method so we can use it as needed\r\nWaiter.extend = Backbone.Model.extend;\r\n\r\n// Waiter.isNodeAttached\r\n// -------------------------\r\n\r\n// Determine if `el` is a child of the document\r\nWaiter.isNodeAttached = el => Backbone.$.contains(document.documentElement, el);\r\n\r\n// Merge `keys` from `options` onto `this`\r\nWaiter.mergeOptions = function(options, keys) {\r\n  if (!options) {\r\n    return;\r\n  }\r\n  _.extend(this, _.pick(options, keys));\r\n};\r\n\r\n// Waiter.getOption\r\n// --------------------\r\n\r\n// Retrieve an object, function or other value from a target\r\n// object or its `options`, with `options` taking precedence.\r\nWaiter.getOption = (target, optionName) => {\r\n  if (!target || !optionName) {\r\n    return;\r\n  }\r\n  if (target.options && target.options[optionName] !== undefined) {\r\n    return target.options[optionName];\r\n  } else {\r\n    return target[optionName];\r\n  }\r\n};\r\n\r\n// Proxy `Waiter.getOption`\r\nWaiter.proxyGetOption = function(optionName) {\r\n  return Waiter.getOption(this, optionName);\r\n};\r\n\r\n// Similar to `_.result`, this is a simple helper\r\n// If a function is provided we call it with context\r\n// otherwise just return the value. If the value is\r\n// undefined return a default value\r\nWaiter._getValue = (value, context, params) => {\r\n  if (_.isFunction(value)) {\r\n    value = params ? value.apply(context, params) : value.call(context);\r\n  }\r\n  return value;\r\n};\r\n\r\n// Waiter.normalizeMethods\r\n// ----------------------\r\n\r\n// Pass in a mapping of events => functions or function names\r\n// and return a mapping of events => functions\r\nWaiter.normalizeMethods = function(hash) {\r\n  return _.reduce(\r\n    hash,\r\n    function(normalizedHash, method, name) {\r\n      if (!_.isFunction(method)) {\r\n        method = this[method];\r\n      }\r\n      if (method) {\r\n        normalizedHash[name] = method;\r\n      }\r\n      return normalizedHash;\r\n    },\r\n    {},\r\n    this\r\n  );\r\n};\r\n\r\n// utility method for parsing @ui. syntax strings\r\n// into associated selector\r\nWaiter.normalizeUIString = (uiString, ui) =>\r\n  uiString.replace(/@ui\\.[a-zA-Z_$0-9]*/g, r => ui[r.slice(4)]);\r\n\r\n// allows for the use of the @ui. syntax within\r\n// a given key for triggers and events\r\n// swaps the @ui with the associated selector.\r\n// Returns a new, non-mutated, parsed events hash.\r\nWaiter.normalizeUIKeys = (hash, ui) =>\r\n  _.reduce(\r\n    hash,\r\n    (memo, val, key) => {\r\n      var normalizedKey = Waiter.normalizeUIString(key, ui);\r\n      memo[normalizedKey] = val;\r\n      return memo;\r\n    },\r\n    {}\r\n  );\r\n\r\n// allows for the use of the @ui. syntax within\r\n// a given value for regions\r\n// swaps the @ui with the associated selector\r\nWaiter.normalizeUIValues = (hash, ui, properties) => {\r\n  _.each(hash, (val, key) => {\r\n    if (_.isString(val)) {\r\n      hash[key] = Waiter.normalizeUIString(val, ui);\r\n    } else if (_.isObject(val) && _.isArray(properties)) {\r\n      _.extend(val, Waiter.normalizeUIValues(_.pick(val, properties), ui));\r\n      /* Value is an object, and we got an array of embedded property names to normalize. */\r\n      _.each(properties, property => {\r\n        var propertyVal = val[property];\r\n        if (_.isString(propertyVal)) {\r\n          val[property] = Waiter.normalizeUIString(propertyVal, ui);\r\n        }\r\n      });\r\n    }\r\n  });\r\n  return hash;\r\n};\r\n\r\nexport default Waiter;\r\n","import $ from \"jquery\";\r\nimport Backbone from \"backbone\";\r\nimport _ from \"underscore\";\r\nimport Waiter from \"./helpers\";\r\n\r\n// Waiter.BaseView\r\n//-------------------\r\n\r\nexport default Backbone.View.extend({\r\n  isDestroyed: false,\r\n\r\n  constructor(options) {\r\n    this.render = _.bind(this.render, this);\r\n\r\n    options = Waiter._getValue(options, this);\r\n\r\n    // this exposes view options to the view initializer\r\n    // this is a backfill since backbone removed the assignment\r\n    // of this.options\r\n    // at some point however this may be removed\r\n    this.options = _.extend({}, _.result(this, \"options\"), options);\r\n\r\n    Backbone.View.call(this, this.options);\r\n  },\r\n\r\n  // normalize the keys of passed hash with the views `ui` selectors.\r\n  // `{\"@ui.foo\": \"bar\"}`\r\n  normalizeUIKeys(hash) {\r\n    var uiBindings = _.result(this, \"_uiBindings\");\r\n    return Waiter.normalizeUIKeys(hash, uiBindings || _.result(this, \"ui\"));\r\n  },\r\n\r\n  // normalize the values of passed hash with the views `ui` selectors.\r\n  // `{foo: \"@ui.bar\"}`\r\n  normalizeUIValues(hash, properties) {\r\n    var ui = _.result(this, \"ui\");\r\n    var uiBindings = _.result(this, \"_uiBindings\");\r\n    return Waiter.normalizeUIValues(hash, uiBindings || ui, properties);\r\n  },\r\n\r\n  bindUIElements() {\r\n    this._bindUIElements();\r\n  },\r\n\r\n  // This method binds the elements specified in the \"ui\" hash inside the view's code with\r\n  // the associated jQuery selectors.\r\n  _bindUIElements() {\r\n    if (!this.ui) {\r\n      return;\r\n    }\r\n\r\n    // store the ui hash in _uiBindings so they can be reset later\r\n    // and so re-rendering the view will be able to find the bindings\r\n    if (!this._uiBindings) {\r\n      this._uiBindings = this.ui;\r\n    }\r\n\r\n    // get the bindings result, as a function or otherwise\r\n    var bindings = _.result(this, \"_uiBindings\");\r\n\r\n    // empty the ui so we don't have anything to start with\r\n    this.ui = {};\r\n\r\n    // bind each of the selectors\r\n    _.each(\r\n      bindings,\r\n      function(selector, key) {\r\n        this.ui[key] = this.$(selector);\r\n      },\r\n      this\r\n    );\r\n  },\r\n\r\n  // This method unbinds the elements specified in the \"ui\" hash\r\n  unbindUIElements() {\r\n    this._unbindUIElements();\r\n  },\r\n\r\n  _unbindUIElements() {\r\n    if (!this.ui || !this._uiBindings) {\r\n      return;\r\n    }\r\n\r\n    // delete all of the existing ui bindings\r\n    _.each(\r\n      this.ui,\r\n      function($el, name) {\r\n        delete this.ui[name];\r\n      },\r\n      this\r\n    );\r\n\r\n    // reset the ui element to the original bindings configuration\r\n    this.ui = this._uiBindings;\r\n    delete this._uiBindings;\r\n  },\r\n\r\n  // Overriding Backbone.View's delegateEvents to handle ui events\r\n  delegateEvents(events) {\r\n    this._delegateDOMEvents(events);\r\n\r\n    return this;\r\n  },\r\n\r\n  // internal method to delegate DOM events and triggers\r\n  _delegateDOMEvents(eventsArg) {\r\n    var events = Waiter._getValue(eventsArg || this.events, this);\r\n\r\n    // normalize ui keys\r\n    events = this.normalizeUIKeys(events);\r\n    if (_.isUndefined(eventsArg)) {\r\n      this.events = events;\r\n    }\r\n\r\n    var combinedEvents = {};\r\n    _.extend(combinedEvents, events);\r\n\r\n    Backbone.View.prototype.delegateEvents.call(this, combinedEvents);\r\n  },\r\n\r\n  destroy() {\r\n    if (this.isDestroyed) {\r\n      return this;\r\n    }\r\n\r\n    var args = _.toArray(arguments);\r\n    this.isDestroyed = true;\r\n\r\n    // unbind UI elements\r\n    this.unbindUIElements();\r\n\r\n    this.isRendered = false;\r\n\r\n    // remove the view from the DOM\r\n    this.remove();\r\n\r\n    return this;\r\n  },\r\n\r\n  // overridable render after everything is ready.\r\n  onRender() {},\r\n\r\n  render() {\r\n    this.isRendered = true;\r\n    this.bindUIElements();\r\n    this.onRender();\r\n\r\n    return this;\r\n  }\r\n});\r\n","import baseView from './baseView';\r\nimport autoLoader from './autoLoader';\r\n\r\nlet Waiter = {};\r\n\r\nWaiter.BaseView = baseView;\r\nWaiter.AutoLoader = autoLoader;\r\n\r\nexport default Waiter;\r\n\r\n","import $ from 'jquery'\r\n\r\nexport default function (View, props) {\r\n    if (View) {\r\n      var myView = new View(props)\r\n      if ($(myView.el).length > 0) {\r\n        // hook up ui and events\r\n        myView.render()\r\n      }\r\n    }\r\n  }"],"names":["Waiter","extend","Backbone","Model","isNodeAttached","$","contains","document","documentElement","el","mergeOptions","options","keys","this","_","pick","getOption","target","optionName","undefined","proxyGetOption","_getValue","value","context","params","isFunction","apply","call","normalizeMethods","hash","reduce","normalizedHash","method","name","normalizeUIString","uiString","ui","replace","r","slice","normalizeUIKeys","memo","val","key","normalizeUIValues","properties","each","isString","isObject","isArray","propertyVal","property","View","render","bind","result","uiBindings","_bindUIElements","_uiBindings","bindings","selector","_unbindUIElements","$el","events","_delegateDOMEvents","eventsArg","isUndefined","combinedEvents","prototype","delegateEvents","isDestroyed","toArray","arguments","unbindUIElements","isRendered","remove","bindUIElements","onRender","BaseView","baseView","AutoLoader","props","myView","length"],"mappings":"wdAIA,IAAIA,KASJA,EAAOC,OAASC,EAASC,MAAMF,OAM/BD,EAAOI,eAAiB,mBAAMF,EAASG,EAAEC,SAASC,SAASC,gBAAiBC,IAG5ET,EAAOU,aAAe,SAASC,EAASC,GACjCD,KAGHV,OAAOY,KAAMC,EAAEC,KAAKJ,EAASC,KAQjCZ,EAAOgB,UAAY,SAACC,EAAQC,MACrBD,GAAWC,SAGZD,EAAON,cAA0CQ,IAA/BF,EAAON,QAAQO,GAC5BD,EAAON,QAAQO,GAEfD,EAAOC,IAKlBlB,EAAOoB,eAAiB,SAASF,UACxBlB,EAAOgB,UAAUH,KAAMK,IAOhClB,EAAOqB,UAAY,SAACC,EAAOC,EAASC,UAC9BV,EAAEW,WAAWH,OACPE,EAASF,EAAMI,MAAMH,EAASC,GAAUF,EAAMK,KAAKJ,IAEtDD,GAQTtB,EAAO4B,iBAAmB,SAASC,UAC1Bf,EAAEgB,OACPD,EACA,SAASE,EAAgBC,EAAQC,UAC1BnB,EAAEW,WAAWO,OACPnB,KAAKmB,IAEZA,MACaC,GAAQD,GAElBD,MAGTlB,OAMJb,EAAOkC,kBAAoB,SAACC,EAAUC,UACpCD,EAASE,QAAQ,uBAAwB,mBAAKD,EAAGE,EAAEC,MAAM,OAM3DvC,EAAOwC,gBAAkB,SAACX,EAAMO,UAC9BtB,EAAEgB,OACAD,EACA,SAACY,EAAMC,EAAKC,YACU3C,EAAOkC,kBAAkBS,EAAKP,IAC5BM,EACfD,QAQbzC,EAAO4C,kBAAoB,SAACf,EAAMO,EAAIS,YAClCC,KAAKjB,EAAM,SAACa,EAAKC,GACb7B,EAAEiC,SAASL,KACRC,GAAO3C,EAAOkC,kBAAkBQ,EAAKN,GACjCtB,EAAEkC,SAASN,IAAQ5B,EAAEmC,QAAQJ,OACpC5C,OAAOyC,EAAK1C,EAAO4C,kBAAkB9B,EAAEC,KAAK2B,EAAKG,GAAaT,MAE9DU,KAAKD,EAAY,gBACbK,EAAcR,EAAIS,GAClBrC,EAAEiC,SAASG,OACTC,GAAYnD,EAAOkC,kBAAkBgB,EAAad,SAKvDP,GCjHT,MAAe3B,EAASkD,KAAKnD,qBACd,uBAEDU,QACL0C,OAASvC,EAAEwC,KAAKzC,KAAKwC,OAAQxC,QAExBb,EAAOqB,UAAUV,EAASE,WAM/BF,QAAUG,EAAEb,UAAWa,EAAEyC,OAAO1C,KAAM,WAAYF,KAE9CyC,KAAKzB,KAAKd,KAAMA,KAAKF,mCAKhBkB,OACV2B,EAAa1C,EAAEyC,OAAO1C,KAAM,sBACzBb,EAAOwC,gBAAgBX,EAAM2B,GAAc1C,EAAEyC,OAAO1C,KAAM,mCAKjDgB,EAAMgB,OAClBT,EAAKtB,EAAEyC,OAAO1C,KAAM,MACpB2C,EAAa1C,EAAEyC,OAAO1C,KAAM,sBACzBb,EAAO4C,kBAAkBf,EAAM2B,GAAcpB,EAAIS,mCAInDY,iDAMA5C,KAAKuB,IAMLvB,KAAK6C,mBACHA,YAAc7C,KAAKuB,QAItBuB,EAAW7C,EAAEyC,OAAO1C,KAAM,oBAGzBuB,QAGHU,KACAa,EACA,SAASC,EAAUjB,QACZP,GAAGO,GAAO9B,KAAKR,EAAEuD,IAExB/C,yCAMGgD,kDAIAhD,KAAKuB,IAAOvB,KAAK6C,gBAKpBZ,KACAjC,KAAKuB,GACL,SAAS0B,EAAK7B,UACLpB,KAAKuB,GAAGH,IAEjBpB,WAIGuB,GAAKvB,KAAK6C,mBACR7C,KAAK6C,sCAICK,eACRC,mBAAmBD,GAEjBlD,kCAIUoD,OACbF,EAAS/D,EAAOqB,UAAU4C,GAAapD,KAAKkD,OAAQlD,QAG/CA,KAAK2B,gBAAgBuB,GAC1BjD,EAAEoD,YAAYD,UACXF,OAASA,OAGZI,OACFlE,OAAOkE,EAAgBJ,KAEhBX,KAAKgB,UAAUC,eAAe1C,KAAKd,KAAMsD,0BAI9CtD,KAAKyD,mBACAzD,KAGEC,EAAEyD,QAAQC,uBAChBF,aAAc,OAGdG,wBAEAC,YAAa,OAGbC,SAEE9D,0DAOF6D,YAAa,OACbE,sBACAC,WAEEhE,YChJPb,YAEJA,EAAO8E,SAAWC,EAClB/E,EAAOgF,oBCJkB5B,EAAM6B,MACvB7B,EAAM,KACJ8B,EAAS,IAAI9B,EAAK6B,GAClB5E,EAAE6E,EAAOzE,IAAI0E,OAAS,KAEjB9B"}